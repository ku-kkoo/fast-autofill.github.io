<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Autofill Bookmarklet Generator</title>


      <style>
         html
         { min-width: 750px;
         max-width: 100%;
         position: relative;
         vertical-align:middle;
         background: LightGray;

         max-width: 1000px;
         margin: 5px auto;
         padding: 5px 10px;
         border-radius: 4px;
         }
         label {
         color: black;
         font-weight: light;
         padding: 4px;
         text-transform: capitalize;
         font-family: Verdana, Arial, Helvetica, sans-serif;
         <!-- font-size: x-small; -->
		 font-size:16px;
         }
         body {
         margin: 0;
         padding: 0;
         border: .5px solid black	;
         border-radius: 0.5rem;
 <!--         color: lightgray; -->
         font-family: 'Nunito', sans-serif;
         }
		 button {
         padding: 10px 20px;
         font-size: 18px;
         background-color: #4285F4;
         color: white;
         border: none;
         border-radius: 5px;
         cursor: pointer;
        }

        button:hover {
        background-color: #357AE8;
        }
         fieldset {
		 border-radius: 3px;
         margin-bottom: 2px;
         <!-- border: none; -->
		 border: 1.5px solid black;
		 border-top: 1.5px solid black;
		  border-right: 1.5px solid black;
		  border-bottom: 1.5px solid black;
		  border-left: 1.5px solid black;
         }
         legend {
         font-size: 1.4em;
         margin-bottom: 5px;
         }
         .number {
         background-color: #5fcf80;
         color: #fff;
         height: 25px;
         width: 25px;
         display: inline-block;
         font-size: 0.8em;
         margin-right: 4px;
         line-height: 25px;
         text-align: center;
         text-shadow: 0 1px 0 rgba(255,255,255,0.2);
         border-radius: 100%;
         }

         input[type="text"],
         input[type="password"],
         input[type="date"],
         input[type="number"],
         select
         {
         background: rgba(255,255,255,0.1);
		 border-radius: 3px;
         border: none;
         font-size: 16px;
         height: auto;
         margin: 0;
         outline: 0;
         height: auto;
         background-color: white;
         <!-- color: #8a97a0; -->
		 color:black;
         box-shadow: 0 1px 0 rgba(0,0,0,0.03) inset;
		padding:1px;
         }
         h2 {
         text-align: center;
         }
		 h1,h3 {
         text-align: center;
         }
		 .registerbtn {  
			 <!--  background-color: #73605B;  --> 
			  color: white; 
				font-size: 15px;
			  padding: 8px 15px 8px 15px;  
			  margin: 8px 0;  
			  border: 2px;  
			  cursor: pointer;  
			  width: 15%;  
			  opacity: 0.8;
				border-radius: 5px;			  
			}  
			.registerbtn:hover {  
			  opacity: 1;  
			}
			
.dropdown-list {
  list-style-type: none;
  padding: 0px;
  margin: 0px;
  margin-top: 1px;
  border-radius: 4px;
  max-height: 180px;
  overflow: auto;
  box-shadow: 1px 1px 1px 0 #bdbdbd;
}

.dropdown-list-item {
  background-color: white;
  padding: 6px 4px;
  font-size: 14px;
}
.dropdown-list-item:hover {
  background-color: rgb(255, 237, 237);
  cursor: pointer;
}

.dropdown-list {
  display: none;
}
.dropdown:focus-within .dropdown-list,
.dropdown-list:hover,
.dropdown-list:focus,
.dropdown-list:focus-within {
  display: block;
}

.flex {
  display: flex;
}
.flex-col {
  flex-direction: column;
}
.w-full {
  width: 50%;
}

 .field-group {
         border: 1.5px solid black;
         border-top: none;
         margin: 20px 1px;
         padding: 6px;
		 border-radius: 3px;
         margin-bottom: 2px;
		 
      }
      .field-group h1 {
         font: 19px verdana;
         margin: -15px -5px 0;
      }
      .field-group h1 span {
         float: left;
      }
      .field-group h1:before {
         border-top: 1.5px solid black;
         content: ' ';
         float: left;
         margin: 9px 3px 0 -1px;
         width: 16px;
      }
      .field-group h1:after {
         border-top: 1.5px solid black;
         content: ' ';
         display: block;
         height: 24px;
         left: 3px;
         margin: 0 1px 0 0;
         overflow: hidden;
         position: relative;
         top: 9px;
		 border-radius: 2px;
      }
input:focus, button:focus, select:focus{outline:1px solid blue}

.autocomplete {
  /*the container must be positioned relative:*/
  position: relative;
  display: inline-block;
}

.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}
.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff;
  border-bottom: 1px solid #d4d4d4;
}
.autocomplete-items div:hover {
  /*when hovering an item:*/
  background-color: #e9e9e9;
}
.autocomplete-active {
  /*when navigating through the items using the arrow keys:*/
  background-color: DodgerBlue !important;
  color: #ffffff;
}

.bookmarklet { 
display: block; padding: 5px; margin-top: 5px; background: #007bff; color: #fff; text-decoration: none; border-radius: 5px; text-align: center; cursor: pointer; 
}
.bookmarklet:hover { 
background: #0056b3; 
}

      </style>


</head>
<body>
	 

    <h2>Magic Autofill Bookmark Generator</h2>
	<label style="font-size: 12px; color: blue; font-weight: bold;">Drag & Drop to the Bookmarklet in the browser.</label>      
	<label style="font-size: 12px; color: green; font-weight: bold;">- Created By Dilip K</label>
   	<button onclick="openIRCTC()">IRCTC</button>
   	<button onclick="openNTES()">NTES</button>	

<div class="field-group">
    <div class="section">
        <h1> <span>Login Details</span></h1>
        <input type="text" id="userid" placeholder="User Name" size="15">
        <input type="password" id="password" placeholder="Password" size="15">
		<input id="showPassword" name="showPassword" type="checkbox" />				
	<label for="showPassword">Show Password</label>
			<script>
			  document.getElementById("showPassword").addEventListener("change", function() {
			    let passwordField = document.getElementById("password");
			    passwordField.type = this.checked ? "text" : "password";
 				});	
			</script>				

    <button id="save-btn" class="save" style="background-color: green; color: black; font-size: 18px; padding: 10px 20px; width: 150px; cursor: pointer;"onclick="saveToFile()">Save</button>
    <button id="download-btn" class="download" style="background-color: yellow; color: black; font-size: 18px; padding: 10px 20px; width: 150px;cursor: pointer;" onclick="downloadFile()">Download</button>
    <button id="load-btn" class="load" style="background-color: DarkOrange; color: black; font-size: 18px; padding: 10px 20px; width: 150px;cursor: pointer;" onclick="loadFromFile()">Load</button>
	
    <input type="file" id="fileInput" style="display: none;" onchange="handleFile(event)">
	

        <a class="bookmarklet" id="loginBookmarklet">Login - Drag & Drop to Bookmark Bar</a>
    </div>
</div>


<div class="field-group">
    <div class="section journey-details">
        <h1> <span>Journey Details</span></h1>
            <input type="text" id="origin" placeholder="From" size="40" aria-controls="pr_id_1_list" style="text-transform: uppercase;">
            <input type="text" id="destination" placeholder="To" size="40" aria-controls="pr_id_2_list" oninput="this.value = this.value.toUpperCase();">
            <input type="calendar" id="jDate" placeholder="DD/MM/YYYY" size="10";>

         </br>
      </br>

            <label> Quota  </label>     
            <select name="jQuota" id="jQuota" >
               <option value="GENERAL">GENERAL</option>
               <option value="TATKAL">TATKAL</option>
               <option value="PREMIUM TATKAL">PREMIUM TATKAL</option>
            </select>

            <label> Class </label>         
            <select name="jClass" id="jClass">
               <option value="">All Classes</option>
               <option value="AC First Class (1A)">AC First Class (1A) </option>
               <option value="AC 2 Tier (2A)">AC 2 Tier (2A)</option>
               <option value="AC 3 Tier (3A)">AC 3 Tier (3A)</option>
               <option value="Sleeper (SL)">Sleeper (SL)</option>
               <option value="AC 3 Economy (3E)">AC 3 Economy (3E)</option>
               <option hidden value="CC">AC Chair car (CC)</option>
               <option hidden value="2S">Second Sitting (2S)</option>
               <option hidden value="EV">Vistadome AC (EV)</option>
			   <option hidden value="EC">Exec. Chair Car (EC)</option>			   
				<option hidden value="EA">Anubhuti Class (EA)</option>
				<option hidden value="FC">First Class (FC)</option>
				<option hidden value="VC">Vistadome Chair Car(VC)</option>
				<option hidden value="VS">Visatodome Non Ac (VS)</option>

            </select>
         

	<input id="dateSpecific" name="dateSpecific" type="checkbox" />				
	<label>Flexible With Date</label>				
	<input id="availableBerth" name="availableBerth" type="checkbox" />				
	<label>Train with Available Berth </label>				

            <input hidden type="text" id="trainNumber" placeholder="Train Number" size="30">
            <input hidden type="text" id="boardingStation" placeholder="Boarding Station" size="30" style="text-transform: uppercase;">
            <a class="bookmarklet" id="journeyBookmarklet">Journey - Drag & Drop to Bookmark Bar</a>

    </div>
</div>

         <div class = "field-group" >
            <h1> <span>Passenger Details</span></h1>
            </legend>
            <label> Passenger 1 </label>      
            <input type="text" id="psgn0" name="name" size="23"  placeholder="Name" maxlength="16" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase();"/> 
            <input type="text" id="psgage0" name="age" size="5"  placeholder="Age" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>  
            <select name="gender" id="psggender0" >
               <option value="">Gender</option>
               <option value="M">Male</option>
               <option value="F">Female</option>
            </select>
            <select name="berth" id="psgberth0">
               <option value="">Berth</option>
               <option value="UB">Upper</option>
               <option value="LB">Lower</option>
               <option value="MB">Middle</option>
               <option value="SL">Side Lower</option>
               <option value="SU">Side Upper</option>
			   <option value="WS">Window Side</option>
				<option value="CB">Cabin</option>
				<option value="CP">Coupe</option>
				<option value="SM">Side Middle</option>
            </select>
			<select name="food" id="psgfood0">
               <option value="">Food Choice</option>
               <option value="V">Veg</option>
               <option value="N">Non Veg</option>
               <option value="D">No Food</option>
            </select>
			
            <br>
            <label> Passenger 2 </label>      
            <input type="text" id="psgn1" name="name" size="23" placeholder="Name"  maxlength="16" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase();"/> 
            <input type="text" id="psgage1" name="age" size="5"  placeholder="Age" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>  
            <select name="gender" id="psggender1">
               <option value="">Gender</option>
               <option value="M">Male</option>
               <option value="F">Female</option>
            </select>
            <select name="berth" id="psgberth1">
               <option value="">Berth</option>
               <option value="UB">Upper</option>
               <option value="LB">Lower</option>
               <option value="MB">Middle</option>
               <option value="SL">Side Lower</option>
               <option value="SU">Side Upper</option>
			   <option value="WS">Window Side</option>
				<option value="CB">Cabin</option>
				<option value="CP">Coupe</option>
				<option value="SM">Side Middle</option>
            </select>
						<select name="food" id="psgfood1">
               <option value="">Food Choice</option>
               <option value="V">Veg</option>
               <option value="N">Non Veg</option>
               <option value="D">No Food</option>
            </select>
            <br>
            <label> Passenger 3 </label>      
            <input type="text" id="psgn2" name="name" size="23" placeholder="Name"  maxlength="16" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase();"/> 
            <input type="text" id="psgage2" name="age" size="5" placeholder="Age" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>  
            <select name="gender" id="psggender2">
               <option value="">Gender</option>
               <option value="M">Male</option>
               <option value="F">Female</option>
            </select>
            <select name="berth" id="psgberth2">
               <option value="">Berth</option>
               <option value="UB">Upper</option>
               <option value="LB">Lower</option>
               <option value="MB">Middle</option>
               <option value="SL">Side Lower</option>
               <option value="SU">Side Upper</option>
			   <option value="WS">Window Side</option>
				<option value="CB">Cabin</option>
				<option value="CP">Coupe</option>
				<option value="SM">Side Middle</option>
            </select>
						<select name="food" id="psgfood2">
               <option value="">Food Choice</option>
               <option value="V">Veg</option>
               <option value="N">Non Veg</option>
               <option value="D">No Food</option>
            </select>
            <br>
            <label> Passenger 4 </label>      
            <input type="text" id="psgn3" name="name" size="23" placeholder="Name"  maxlength="16" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase();"/> 
            <input type="text" id="psgage3" name="age" size="5" placeholder="Age" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>  
            <select name="gender" id="psggender3">
               <option value="">Gender</option>
               <option value="M">Male</option>
               <option value="F">Female</option>
            </select>
            <select name="berth" id="psgberth3">
               <option value="">Berth</option>
               <option value="UB">Upper</option>
               <option value="LB">Lower</option>
               <option value="MB">Middle</option>
               <option value="SL">Side Lower</option>
               <option value="SU">Side Upper</option>
			   <option value="WS">Window Side</option>
				<option value="CB">Cabin</option>
				<option value="CP">Coupe</option>
				<option value="SM">Side Middle</option>
            </select>
						<select name="food" id="psgfood3">
                <option value="">Food Choice</option>
				<option value="D">No Food</option>
               <option value="V">Veg</option>
               <option value="N">Non Veg</option>
              
            </select>

            <br>
            <label> Passenger 5 </label>      
            <input type="text" id="psgn4" name="name" size="23" placeholder="Name"  maxlength="16" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase();"/> 
            <input type="text" id="psgage4" name="age" size="5" placeholder="Age" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>  
            <select name="gender" id="psggender4">
               <option value="">Gender</option>
               <option value="M">Male</option>
               <option value="F">Female</option>
            </select>
            <select name="berth" id="psgberth4">
               <option value="">Berth</option>
               <option value="UB">Upper</option>
               <option value="LB">Lower</option>
               <option value="MB">Middle</option>
               <option value="SL">Side Lower</option>
               <option value="SU">Side Upper</option>
			   <option value="WS">Window Side</option>
				<option value="CB">Cabin</option>
				<option value="CP">Coupe</option>
				<option value="SM">Side Middle</option>
            </select>
						<select name="food" id="psgfood4">
                <option value="">Food Choice</option>
				<option value="D">No Food</option>
               <option value="V">Veg</option>
               <option value="N">Non Veg</option>
              
            </select>
            <br>
            <label> Passenger 6 </label>      
            <input type="text" id="psgn5" name="name" size="23" placeholder="Name"  maxlength="16" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase();"/> 
            <input type="text" id="psgage5" name="age" size="5" placeholder="Age" maxlength="3" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>  
            <select name="gender" id="psggender5">
               <option value="">Gender</option>
               <option value="M">Male</option>
               <option value="F">Female</option>
            </select>
            <select name="berth" id="psgberth5">
               <option value="">Berth</option>
               <option value="UB">Upper</option>
               <option value="LB">Lower</option>
               <option value="MB">Middle</option>
               <option value="SL">Side Lower</option>
               <option value="SU">Side Upper</option>
			   <option value="WS">Window Side</option>
				<option value="CB">Cabin</option>
				<option value="CP">Coupe</option>
				<option value="SM">Side Middle</option>
            </select>
		<select name="food" id="psgfood5">
                <option value="">Food Choice</option>
				<option value="D">No Food</option>
               <option value="V">Veg</option>
               <option value="N">Non Veg</option>
              
            </select>

				</br>
         </br>
				<input id="autoUpgradation" name="autoUpgradation" type="checkbox" />				
				<label>Consider Auto Upgradation</label>				
				<input id="confirmberths" name="confirmberths" type="checkbox" /> 
				<label>Book only if confirm berths are allotted.</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<label>Travel insurance</label>
				<input id="travelInsuranceOpted-1" value="yes" name="travelInsuranceOpted" type="radio" />
				Yes 	
				<input id="travelInsuranceOpted-2" value="no" name="travelInsuranceOpted" type="radio" />
				No
            <br><br>
            <label> Mobile number</label>      
            <input type="text" id="mobileNumber" name="mobileNumber" size="10" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/> 
            &nbsp;&nbsp;&nbsp;&nbsp;            

            <label style="font-size: 12px; color: red; font-weight: bold;">Esse Passenger Page Pe Hi Payment Type Selection Ho Jayega.</label>      

			<input hidden type="text" id="vpa" name="vpa" size="30" placeholder="e.g. 123456@paytm"/>

            <br>

            <a class="bookmarklet" id="passengerBookmarklet" draggable="true">Passenger - Drag & Drop to Bookmark Bar</a>

         </div>


  <script>
    (function () {
      const key = "autoSaved_paymentMethod";
      const select = document.getElementById("paymentMethod");
      if (!select) return;
      // Restore value
      const saved = localStorage.getItem(key);
      if (saved && Array.from(select.options).some(opt => opt.value === saved)) {
        select.value = saved;
      }
      // Auto-save on change
      select.addEventListener("change", function () {
        localStorage.setItem(key, select.value);
      });
    })();	
  </script>	

	
<div class = "field-group" >
     <div class="section">
        <h1><span>Passenger Captcha & Payment Type Selection</span></h1>

			<label>Payment method</label>
                     <select name="paymentMethod" id="paymentMethod">
                        <option value="2">HIM/ UPI/ USSD</option>
                        <option hidden value="UPIID">VPA / UPI ID</option> 
                        <option value="3">IRCTC e-Wallet</option>                   
                    </select>

	     <input hidden type="text" id="vpa" name="vpa" size="30" placeholder="e.g. 123456@paytm"/>

             <a class="bookmarklet" id="captchaQRPaymentSelectionBookmarklet">Captcha & BHIM/ UPI/ USSD Payment Selection - Drag & Drop to Bookmark Bar</a>
             <a class="bookmarklet" id="captchaIrctcPaymentSelectionBookmarklet">Captcha & IRCTC e-Wallet Payment Selection - Drag & Drop to Bookmark Bar</a>

    </div>
</div>


<div class = "field-group" >
     <div hidden class="section">
        <h1><span>Payment Details</span></h1>

			<label>Payment method</label>
                     <select name="paymentMethod" id="paymentMethod">
                        <option value="QRCD">HIM/ UPI/ USSD</option>
                        <option value="UPIID">VPA / UPI ID</option> 
                        <option value="IRCWA">IRCTC e-Wallet</option>                   
                    </select>

	     <input type="text" id="vpa" name="vpa" size="30" placeholder="e.g. 123456@paytm"/>


<br> </br>

            <input type="text" id="cardNumber" placeholder="Card Number">
            <input type="text" id="expiry" placeholder="Expiry Date">
            <input type="text" id="cvv" placeholder="CVV">
             <a class="bookmarklet" id="paymentBookmarklet">Drag & Drop to Bookmark Bar</a>

    </div>
</div>


	
<script>
    function updateBookmarklet(type) {
        let script = "";

        if (type === 'login') {
            script = `    userId = document.querySelector("[placeholder='User Name']");
    pwd = document.querySelector("[placeholder='Password']");
    loginCaptcha = document.querySelector("[id='captcha']");

    ;if (userId) {
       userId.value = '${document.getElementById('userid').value}';
        userId.dispatchEvent(new Event('input'))
    }

    ;if (pwd) {
        pwd.value = '${document.getElementById('password').value}';
        pwd.dispatchEvent(new Event('input'))
    }

    let captchaImg = document.querySelector('.captcha-img');
    if (captchaImg) {
        captchaImg.style.width = "350px";
         captchaImg.style.height = "auto"; 
        captchaImg.style.border = "2px solid red"; 
        captchaImg.style.transition = "0.3s ease";  }
    let captchaField = document.querySelector('input[formcontrolname="captcha"]');

    ;if (loginCaptcha) {        loginCaptcha.focus();}

`;
			

        } else if (type === 'journey') {
            script = `
    fromStation = document.querySelector("[aria-controls='pr_id_1_list']");
    toStation = document.querySelector("[aria-controls='pr_id_2_list']");
    journeydate = document.querySelector('p-calendar[formcontrolname="journeyDate"] input');
    quota = document.querySelector("[aria-label='GENERAL']");
    Class = document.querySelector("journeyClass");
    flexiDate = document.getElementById("dateSpecific");
    availableBerth = document.getElementById("availableBerth");
    searchButton = document.querySelector('button.search_btn.train_Search');

        setTimeout(()=>{ 
    ;if (fromStation) {
        fromStation.value = '${document.getElementById('origin').value}',200;
        fromStation.dispatchEvent(new Event('input'));
        fromStation.click()
    }
        }, 100); 


        setTimeout(()=>{ 
    ;if (toStation) {
        toStation.value = '${document.getElementById('destination').value}',300;
        toStation.dispatchEvent(new Event('input'));
        toStation.click()
    }
        }, 100); 

        setTimeout(()=>{ 
    ;if (journeydate) {
        journeydate.value = '${document.getElementById('jDate').value}',500;
        journeydate.dispatchEvent(new Event('input'))
    }
        }, 100); 

    ;if (flexiDate) {
	flexiDate.checked = true;
        flexiDate.removeAttribute('disabled');
    }

    ;if (availableBerth) {
        availableBerth.checked = true;
        availableBerth.removeAttribute('disabled');
    }

        setTimeout(()=>{ 
    let dropdownButton = document.querySelector('p-dropdown[formcontrolname="journeyQuota"] .ui-dropdown-trigger'); 
    if(dropdownButton){ 
        dropdownButton.click(); 
        setTimeout(()=>{ 
            let options = document.querySelectorAll('li.ui-dropdown-item'); 
            options.forEach(option => { 
                if(option.innerText.trim() === '${document.getElementById('jQuota').value}'){ 
                    option.click(); 
                } 
            }); 
        }, 200); 
    } 
        }, 2000); 

        setTimeout(()=>{ 
    let dropdownButton = document.querySelector('p-dropdown[formcontrolname="journeyClass"] .ui-dropdown-trigger'); 
    if(dropdownButton){ 
        dropdownButton.click(); 
        setTimeout(()=>{ 
            let options = document.querySelectorAll('li.ui-dropdown-item'); 
            options.forEach(option => { 
                if(option.innerText.trim() === '${document.getElementById('jClass').value}'){ 
                    option.click(); 
                } 
            }); 
        }, 200); 
    } 
        }, 3000); 
 if (searchButton) searchButton.focus(); ;

`;

        } else if (type === 'passenger') {
            script = `

    async function fillPassengerDetails() {
        function setValue(element, value) {
            if (element) {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }

        function selectValue(element, value) {
            if (element) {
                element.value = value;
                element.dispatchEvent(new Event('change', { bubbles: true }));
            }
        }


        let passengers = [
            { name: '${document.getElementById('psgn0').value}', age: '${document.getElementById('psgage0').value}', gender: '${document.getElementById('psggender0').value}', berth: '${document.getElementById('psgberth0').value}', food: '${document.getElementById('psgfood0').value}' },
            { name: '${document.getElementById('psgn1').value}', age: '${document.getElementById('psgage1').value}', gender: '${document.getElementById('psggender1').value}', berth: '${document.getElementById('psgberth1').value}', food: '${document.getElementById('psgfood1').value}' },
            { name: '${document.getElementById('psgn2').value}', age: '${document.getElementById('psgage2').value}', gender: '${document.getElementById('psggender2').value}', berth: '${document.getElementById('psgberth2').value}', food: '${document.getElementById('psgfood2').value}' },
            { name: '${document.getElementById('psgn3').value}', age: '${document.getElementById('psgage3').value}', gender: '${document.getElementById('psggender3').value}', berth: '${document.getElementById('psgberth3').value}', food: '${document.getElementById('psgfood3').value}' },
            { name: '${document.getElementById('psgn4').value}', age: '${document.getElementById('psgage4').value}', gender: '${document.getElementById('psggender4').value}', berth: '${document.getElementById('psgberth4').value}', food: '${document.getElementById('psgfood4').value}' },
            { name: '${document.getElementById('psgn5').value}', age: '${document.getElementById('psgage5').value}', gender: '${document.getElementById('psggender5').value}', berth: '${document.getElementById('psgberth5').value}', food: '${document.getElementById('psgfood5').value}' },

        ];

        let validPassengers = passengers.filter(p => p.name.trim() !== '');
        let totalPassengers = validPassengers.length;
        
        let addPassengerButton = document.querySelector("button[aria-label='Add Passenger']") || document.querySelector("span.prenext");

        for (let i = 0; i < totalPassengers; i++) {
            let nameField = document.querySelectorAll("[placeholder='Name']")[i];
            let ageField = document.querySelectorAll("[formcontrolname='passengerAge']")[i];
            let genderField = document.querySelectorAll("[formcontrolname='passengerGender']")[i];
            let berthField = document.querySelectorAll("[formcontrolname='passengerBerthChoice']")[i];
            let foodField = document.querySelectorAll("[formcontrolname='passengerFoodChoice']")[i];

            if (nameField) setValue(nameField, validPassengers[i].name);
            if (ageField) setValue(ageField, validPassengers[i].age);
            if (genderField) selectValue(genderField, validPassengers[i].gender);
            if (berthField) selectValue(berthField, validPassengers[i].berth);
            if (foodField) selectValue(foodField, validPassengers[i].food);

            await new Promise(resolve => setTimeout(resolve, 500));


            if (i < totalPassengers - 1 && addPassengerButton && !addPassengerButton.disabled) {
                addPassengerButton.click();
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        let mobileField = document.getElementById("mobileNumber");
        if (mobileField) {
            setValue(mobileField, '${document.getElementById('mobileNumber').value}');
            mobileField.dispatchEvent(new Event('change', { bubbles: true }));
        }

        let autoUpgrade = document.getElementById("autoUpgradation");
        let confirmBerth = document.getElementById("confirmberths");

        if (autoUpgrade) autoUpgrade.checked = true;
        if (confirmBerth) {
            confirmBerth.checked = true;
            confirmBerth.removeAttribute("disabled");
        }

        let paymentOption = document.querySelector('input[type="radio"][name="paymentType"][value= "${document.getElementById('paymentMethod').value}"]');
        if (paymentOption) {
            paymentOption.click();
            paymentOption.dispatchEvent(new Event('change', { bubbles: true }));
        }

        let insuranceOption = document.getElementById('travelInsuranceOptedYes');
        if (insuranceOption) insuranceOption.click();

        setTimeout(() => {
            let searchButton = document.querySelector(".train_Search.btnDefault");
            if (searchButton) searchButton.click();
        }, 1000);
    }

    setTimeout(fillPassengerDetails, 1000);

`;


       } else if (type === 'captchaQRPaymentSelection') {
            script = `
						    let captchaImg = document.querySelector('.captcha-img');
    						if (captchaImg) {
        					captchaImg.style.width = "350px";         captchaImg.style.height = "auto"; 
        					captchaImg.style.border = "2px solid red";
        					captchaImg.style.transition = "0.3s ease";
    					}
    
    						let psgcaptcha = document.querySelector("[id='captcha']");
    						if (psgcaptcha) {        psgcaptcha.focus(); }

 

 			{function clickElementContainingText(s,t){
 			let e=document.querySelectorAll(s);
 			for(let l of e)
 			if(l.innerText.trim().includes(t)){l.click();return}}
 
 			function focusElement(s){
 			let e=document.querySelector(s);e&&e.focus()}
 			clickElementContainingText("div.bank-type","BHIM/ UPI/ USSD");
 			clickElementContainingText("div.bank-text","Pay using BHIM (Powered by PAYTM ) also accepts UPI");
 
 			var btn=document.querySelector("#psgn-form button.btn.btn-primary.hidden-xs.ng-star-inserted");
 			if(btn){btn.focus();btn.style.outline="3px solid red";
 			btn.style.boxShadow="0 0 10px red";}
		}

	
`;

      } else if (type === 'captchaIrctcPaymentSelection') {
            script = `
			try {
    var elements = document.querySelectorAll('.bank-type');
    var found = false;
    elements.forEach(function(el){
      if (el.innerText.includes("IRCTC eWallet")) {
        el.click();
        console.log("IRCTC eWallet clicked.");
        found = true;
      }
    });

    let captchaImg = document.querySelector('.captcha-img');
    if (captchaImg) {
      captchaImg.style.width = "350px";
      captchaImg.style.height = "auto";
      captchaImg.style.border = "2px solid red";
      captchaImg.style.transition = "0.3s ease";
    }

    let psgcaptcha = document.querySelector("[id='captcha']");
    if (psgcaptcha) {
      psgcaptcha.focus();
    }

  } catch(e) {
    console.error("Error:", e);
  }
	
`;
		
        } else if (type === 'payment') {
            script = `document.querySelector('[name="cardNumber"]').value = '${document.getElementById('cardNumber').value}';
                      document.querySelector('[name="expiry"]').value = '${document.getElementById('expiry').value}';
                      document.querySelector('[name="cvv"]').value = '${document.getElementById('cvv').value}';`;

    function clickElementContainingText(parentSelector, text) {
        let elements = document.querySelectorAll(parentSelector);
        for (let el of elements) {
            if (el.innerText.trim().includes(text)) {
                el.click();
                console.log(`Clicked: ${text}`);
                return;
            }
        }
        console.log(`Not found: ${text}`);
    }

    function focusElement(selector) {
        let element = document.querySelector(selector);
        if (element) {
            element.focus();
            console.log("Focused on 'Pay & Book' button");
        } else {
            console.log("'Pay & Book' button not found!");
        }
    }

    clickElementContainingText("div.bank-type", "BHIM/ UPI/ USSD",1000);
    clickElementContainingText("div.bank-text", "Pay using BHIM (Powered by PAYTM ) also accepts UPI",2000);
    focusElement("button.btn.btn-primary.hidden-xs");


        }

        let bookmarklet = `javascript:(function(){ ${script} })();`;
        document.getElementById(type + "Bookmarklet").href = bookmarklet;
    }

    // Auto-update bookmarklets when user inputs data
    document.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", () => {
            updateBookmarklet("login");
            updateBookmarklet("journey");
            updateBookmarklet("passenger");
            updateBookmarklet("captchaQRPaymentSelection");
            updateBookmarklet("captchaIrctcPaymentSelection");
            updateBookmarklet("payment");
        });
    });

    // Initial bookmarklet generation
    updateBookmarklet("login");
    updateBookmarklet("journey");
    updateBookmarklet("passenger");
    updateBookmarklet("captchaQRPaymentSelection");
    updateBookmarklet("captchaIrctcPaymentSelection");
    updateBookmarklet("payment");
	
	document.getElementById("passengerBookmarklet").click();
        document.getElementById("journeyBookmarklet").click();
        document.getElementById("loginBookmarklet").click();
	
</script>



<script>
    // ðŸ”¹ Data ko LocalStorage aur Text File me Save karna
 function downloadFile() {
    let userData = {
        userid: document.getElementById("userid").value || "",
        password: document.getElementById("password").value || "",
 	//       showPassword: document.getElementById("showPassword").checked,

        origin: document.getElementById("origin").value || "",
        destination: document.getElementById("destination").value || "",
        jDate: document.getElementById("jDate").value || "",
        jQuota: document.getElementById("jQuota").value || "",
        jClass: document.getElementById("jClass").value || "",
        mobileNumber: document.getElementById("mobileNumber").value || "",
	paymentMethod: document.getElementById("paymentMethod").value || "",

        passengers: []
    };

    // âœ… Passenger Data ko loop se store karna
    for (let i = 0; i <= 5; i++) {
        if (!document.getElementById(`psgn${i}`)) break;
        let psgn = document.getElementById(`psgn${i}`).value || "";
        let psgage = document.getElementById(`psgage${i}`).value || "";
        let psggender = document.getElementById(`psggender${i}`).value || "";
        let psgberth = document.getElementById(`psgberth${i}`).value || "";
        let psgfood = document.getElementById(`psgfood${i}`).value || "";

        userData.passengers.push({ psgn, psgage, psggender, psgberth, psgfood });
    }

    // âœ… Checkbox Values
    userData.autoUpgradation = document.getElementById("autoUpgradation").checked;
    userData.confirmberths = document.getElementById("confirmberths").checked;

    // ðŸ”¹ Pehla Passenger ka Naam lena
    let firstPassengerName = userData.passengers.length > 0 ? userData.passengers[0].psgn : "Passenger";
    firstPassengerName = firstPassengerName.replace(/\s+/g, "_").replace(/[^a-zA-Z0-9_]/g, ""); // âœ… Special characters remove

    // âœ… JSON ko ek Text File me Convert karna
    let blob = new Blob([JSON.stringify(userData, null, 2)], { type: "text/plain" });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `${firstPassengerName || "Passenger"}.txt`; // âœ… Pehle Passenger ka Naam as Filename
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    localStorage.setItem("userData", JSON.stringify(userData)); // âœ… LocalStorage me bhi save hoga
    alert(`Data Saved Successfully as ${firstPassengerName}.txt`);
	

        document.getElementById("loginBookmarklet").click();

}

    // ðŸ”¹ Text File se Data Load karna >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    function loadFromFile() {
        document.getElementById("fileInput").click();
    }

    // ðŸ”¹ File se Data Read karke LocalStorage aur Form me Fill karna
    function handleFile(event) {
        let file = event.target.files[0];
        if (!file) return;

        let reader = new FileReader();
        reader.onload = function (e) {
            let userData = JSON.parse(e.target.result);

			console.log("Loaded User Data:", userData);  // âœ… Debugging ke liye

        // âœ… Sabhi Input Fields Set karna aur Auto Trigger karna
        function setAndTrigger(id, value) {
            let inputField = document.getElementById(id);
            if (inputField) {
                inputField.value = value || "";
                inputField.dispatchEvent(new Event("change", { bubbles: true }));
            }
        }
        // âœ… User Data Fields
        setAndTrigger("userid", userData.userid);
        setAndTrigger("password", userData.password);
        setAndTrigger("origin", userData.origin);
        setAndTrigger("destination", userData.destination);
        setAndTrigger("jDate", userData.jDate);
        setAndTrigger("jQuota", userData.jQuota);
        setAndTrigger("jClass", userData.jClass);
        setAndTrigger("mobileNumber", userData.mobileNumber);
	setAndTrigger("paymentMethod", userData.paymentMethod);

        // âœ… Passenger Details
        userData.passengers.forEach((psg, index) => {
            setAndTrigger(`psgn${index}`, psg.psgn);
            setAndTrigger(`psgage${index}`, psg.psgage);
            setAndTrigger(`psggender${index}`, psg.psggender);
            setAndTrigger(`psgberth${index}`, psg.psgberth);
            setAndTrigger(`psgfood${index}`, psg.psgfood);
        });

        // âœ… Checkbox Update aur Trigger
        document.getElementById("autoUpgradation").checked = !!userData.autoUpgradation;
        document.getElementById("confirmberths").checked = !!userData.confirmberths;
        document.getElementById("autoUpgradation").dispatchEvent(new Event("change", { bubbles: true }));
        document.getElementById("confirmberths").dispatchEvent(new Event("change", { bubbles: true }));

        // âœ… Data LocalStorage me Save
        localStorage.setItem("userData", JSON.stringify(userData));

        console.log("Form Updated & Events Triggered Automatically!");
        document.getElementById("loginBookmarklet").click();
		
    };

    reader.readAsText(file);
}
    // ðŸ”¹ LocalStorage Clear karna
    document.getElementById("save-btn").addEventListener("click", function () {
 {
	document.getElementById("passengerBookmarklet").click();
        document.getElementById("journeyBookmarklet").click();
        document.getElementById("loginBookmarklet").click();
        document.getElementById("captchaQRPaymentSelection").click();		
        document.getElementById("captchaIrctcPaymentSelection").click();	
	 alert(`Data Saved Successfully...`);

        }
    });
		
</script> 

    <script>
        function openIRCTC() {
            window.open("https://www.irctc.co.in", "_blank");
        }
        function openNTES() {
            window.open("https://www.indianrail.gov.in/enquiry/TBIS/TrainBetweenImportantStations.html?locale=en", "_blank");
        }	    
    </script>

</body>
</html>
